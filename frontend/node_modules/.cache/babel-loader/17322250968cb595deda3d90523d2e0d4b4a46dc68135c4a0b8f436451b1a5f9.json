{"ast":null,"code":"import axios from 'axios';\n\n// API base URL\nconst API_URL = process.env.VUE_APP_API_URL || 'http://localhost:8080/api';\n\n// Helper to set auth header\nconst setAuthHeader = token => {\n  if (token) {\n    axios.defaults.headers.common['Authorization'] = `Bearer ${token}`;\n  } else {\n    delete axios.defaults.headers.common['Authorization'];\n  }\n};\nconst state = {\n  token: localStorage.getItem('token') || '',\n  user: JSON.parse(localStorage.getItem('user')) || null,\n  status: ''\n};\nconst getters = {\n  isAuthenticated: state => !!state.token,\n  authStatus: state => state.status,\n  user: state => state.user\n};\nconst actions = {\n  // Login action\n  async login({\n    commit\n  }, user) {\n    commit('AUTH_REQUEST');\n    try {\n      const response = await axios.post(`${API_URL}/auth/login`, user);\n      const {\n        token,\n        user: userData\n      } = response.data;\n\n      // Store token in localStorage\n      localStorage.setItem('token', token);\n      localStorage.setItem('user', JSON.stringify(userData));\n\n      // Set auth header\n      setAuthHeader(token);\n      commit('AUTH_SUCCESS', {\n        token,\n        user: userData\n      });\n      return response;\n    } catch (error) {\n      commit('AUTH_ERROR', error);\n      localStorage.removeItem('token');\n      localStorage.removeItem('user');\n      throw error;\n    }\n  },\n  // Logout action\n  async logout({\n    commit\n  }) {\n    try {\n      // Call logout endpoint if needed\n      await axios.post(`${API_URL}/auth/logout`);\n    } catch (error) {\n      console.error('Logout error:', error);\n    }\n\n    // Clean up regardless of the API call result\n    localStorage.removeItem('token');\n    localStorage.removeItem('user');\n    setAuthHeader(null);\n    commit('AUTH_LOGOUT');\n  },\n  // Restore session from token\n  async restoreSession({\n    commit\n  }, token) {\n    setAuthHeader(token);\n    commit('AUTH_REQUEST');\n    try {\n      const response = await axios.get(`${API_URL}/auth/profile`);\n      const userData = response.data;\n\n      // Update user data in localStorage\n      localStorage.setItem('user', JSON.stringify(userData));\n      commit('AUTH_SUCCESS', {\n        token,\n        user: userData\n      });\n      return response;\n    } catch (error) {\n      commit('AUTH_ERROR', error);\n      localStorage.removeItem('token');\n      localStorage.removeItem('user');\n      setAuthHeader(null);\n      throw error;\n    }\n  },\n  // Change password\n  async changePassword({\n    commit\n  }, {\n    oldPassword,\n    newPassword\n  }) {\n    try {\n      const response = await axios.post(`${API_URL}/auth/change-password`, {\n        old_password: oldPassword,\n        new_password: newPassword\n      });\n      return response;\n    } catch (error) {\n      throw error;\n    }\n  }\n};\nconst mutations = {\n  AUTH_REQUEST(state) {\n    state.status = 'loading';\n  },\n  AUTH_SUCCESS(state, {\n    token,\n    user\n  }) {\n    state.status = 'success';\n    state.token = token;\n    state.user = user;\n  },\n  AUTH_ERROR(state) {\n    state.status = 'error';\n    state.token = '';\n    state.user = null;\n  },\n  AUTH_LOGOUT(state) {\n    state.status = '';\n    state.token = '';\n    state.user = null;\n  }\n};\nexport default {\n  namespaced: true,\n  state,\n  getters,\n  actions,\n  mutations\n};","map":{"version":3,"names":["axios","API_URL","process","env","VUE_APP_API_URL","setAuthHeader","token","defaults","headers","common","state","localStorage","getItem","user","JSON","parse","status","getters","isAuthenticated","authStatus","actions","login","commit","response","post","userData","data","setItem","stringify","error","removeItem","logout","console","restoreSession","get","changePassword","oldPassword","newPassword","old_password","new_password","mutations","AUTH_REQUEST","AUTH_SUCCESS","AUTH_ERROR","AUTH_LOGOUT","namespaced"],"sources":["E:/GoLand20240404/Project/student_management/frontend/src/store/modules/auth.js"],"sourcesContent":["import axios from 'axios'\r\n\r\n// API base URL\r\nconst API_URL = process.env.VUE_APP_API_URL || 'http://localhost:8080/api'\r\n\r\n// Helper to set auth header\r\nconst setAuthHeader = (token) => {\r\n  if (token) {\r\n    axios.defaults.headers.common['Authorization'] = `Bearer ${token}`\r\n  } else {\r\n    delete axios.defaults.headers.common['Authorization']\r\n  }\r\n}\r\n\r\nconst state = {\r\n  token: localStorage.getItem('token') || '',\r\n  user: JSON.parse(localStorage.getItem('user')) || null,\r\n  status: ''\r\n}\r\n\r\nconst getters = {\r\n  isAuthenticated: state => !!state.token,\r\n  authStatus: state => state.status,\r\n  user: state => state.user\r\n}\r\n\r\nconst actions = {\r\n  // Login action\r\n  async login({ commit }, user) {\r\n    commit('AUTH_REQUEST')\r\n    try {\r\n      const response = await axios.post(`${API_URL}/auth/login`, user)\r\n      const { token, user: userData } = response.data\r\n      \r\n      // Store token in localStorage\r\n      localStorage.setItem('token', token)\r\n      localStorage.setItem('user', JSON.stringify(userData))\r\n      \r\n      // Set auth header\r\n      setAuthHeader(token)\r\n      \r\n      commit('AUTH_SUCCESS', { token, user: userData })\r\n      return response\r\n    } catch (error) {\r\n      commit('AUTH_ERROR', error)\r\n      localStorage.removeItem('token')\r\n      localStorage.removeItem('user')\r\n      throw error\r\n    }\r\n  },\r\n  \r\n  // Logout action\r\n  async logout({ commit }) {\r\n    try {\r\n      // Call logout endpoint if needed\r\n      await axios.post(`${API_URL}/auth/logout`)\r\n    } catch (error) {\r\n      console.error('Logout error:', error)\r\n    }\r\n    \r\n    // Clean up regardless of the API call result\r\n    localStorage.removeItem('token')\r\n    localStorage.removeItem('user')\r\n    setAuthHeader(null)\r\n    commit('AUTH_LOGOUT')\r\n  },\r\n  \r\n  // Restore session from token\r\n  async restoreSession({ commit }, token) {\r\n    setAuthHeader(token)\r\n    commit('AUTH_REQUEST')\r\n    \r\n    try {\r\n      const response = await axios.get(`${API_URL}/auth/profile`)\r\n      const userData = response.data\r\n      \r\n      // Update user data in localStorage\r\n      localStorage.setItem('user', JSON.stringify(userData))\r\n      \r\n      commit('AUTH_SUCCESS', { token, user: userData })\r\n      return response\r\n    } catch (error) {\r\n      commit('AUTH_ERROR', error)\r\n      localStorage.removeItem('token')\r\n      localStorage.removeItem('user')\r\n      setAuthHeader(null)\r\n      throw error\r\n    }\r\n  },\r\n  \r\n  // Change password\r\n  async changePassword({ commit }, { oldPassword, newPassword }) {\r\n    try {\r\n      const response = await axios.post(`${API_URL}/auth/change-password`, {\r\n        old_password: oldPassword,\r\n        new_password: newPassword\r\n      })\r\n      return response\r\n    } catch (error) {\r\n      throw error\r\n    }\r\n  }\r\n}\r\n\r\nconst mutations = {\r\n  AUTH_REQUEST(state) {\r\n    state.status = 'loading'\r\n  },\r\n  AUTH_SUCCESS(state, { token, user }) {\r\n    state.status = 'success'\r\n    state.token = token\r\n    state.user = user\r\n  },\r\n  AUTH_ERROR(state) {\r\n    state.status = 'error'\r\n    state.token = ''\r\n    state.user = null\r\n  },\r\n  AUTH_LOGOUT(state) {\r\n    state.status = ''\r\n    state.token = ''\r\n    state.user = null\r\n  }\r\n}\r\n\r\nexport default {\r\n  namespaced: true,\r\n  state,\r\n  getters,\r\n  actions,\r\n  mutations\r\n} "],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}